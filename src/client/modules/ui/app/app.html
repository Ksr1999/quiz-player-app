<template>
    <ui-header nickname={nickname}></ui-header>

    <div class="body">
        <template if:true={session}>
            <!-- Unauthenticated -->
            <template if:false={isAuthenticated}>
                <!-- Registrations open -->
                <ui-registration-form
                    if:true={isRegistrationPhase}
                    session-id={session.id}
                    onregistered={handleRegistered}
                ></ui-registration-form>
                <!-- Registrations closed -->
                <h1 if:false={isRegistrationPhase}>
                    Sorry, registrations are closed.
                </h1>
            </template>

            <!-- Authenticated -->
            <template if:true={isAuthenticated}>
                <!-- Registration -->
                <ui-spinner
                    if:true={isRegistrationPhase}
                    message="Waiting for host to start game..."
                ></ui-spinner>

                <!-- Pre-question -->
                <ui-spinner
                    if:true={isPreQuestionPhase}
                    message="Wait for question..."
                ></ui-spinner>

                <!-- Question -->
                <template if:true={isQuestionPhase}>
                    <!-- Not yet answered -->
                    <ui-question
                        if:false={lastAnswer}
                        question={session.question}
                        onanswer={handleAnswer}
                    ></ui-question>

                    <!-- Answered -->
                    <template if:true={lastAnswer}>
                        <h1>
                            You answered
                            <span data-answer={lastAnswer}>{lastAnswer}</span>
                        </h1>

                        <!-- Waiting for others -->
                        <ui-spinner
                            if:true={answerSaved}
                            message="Collecting answers from other players..."
                        ></ui-spinner>
                        <!-- Saving answer -->
                        <ui-spinner
                            if:false={answerSaved}
                            message="Saving answer..."
                        ></ui-spinner>
                    </template>
                </template>

                <!-- Question Results -->
                <template if:true={isQuestionResultsPhase}>
                    <!-- Answered -->
                    <template if:true={lastAnswer}>
                        <h1>
                            You answered
                            <span data-answer={lastAnswer}>{lastAnswer}</span>
                        </h1>
                        <template if:true={answerSaved}>
                            <!-- Correct answer -->
                            <h1 if:true={isCorrectAnswer}>
                                Well done, that's correct!
                            </h1>
                            <!-- Wrong answer -->
                            <h1 if:false={isCorrectAnswer}>
                                The correct answer was
                                <span data-answer={session.correctAnswer}
                                    >{session.correctAnswer}</span
                                >
                            </h1>
                        </template>
                        <!-- Answer not saved -->
                        <h1 if:false={answerSaved}>
                            You didn't answer in time.
                        </h1>
                    </template>
                    <!-- Did not answer -->
                    <h1 if:false={lastAnswer}>You didn't answer in time.</h1>
                </template>

                <!-- Game Results -->
                <ui-player-stats
                    if:true={isGameResultsPhase}
                    session-id={session.id}
                    player-id={playerId}
                ></ui-player-stats>
            </template>
        </template>

        <!-- Errors -->
        <h1 if:true={errorMessage} class="error">{errorMessage}</h1>
    </div>
    <!-- End body -->

    <!-- Footer with score and rank -->
    <ui-footer if:true={showFooter} leaderboard={playerLeaderboard}></ui-footer>

    <!-- Credits -->
    <div if:false={showFooter} class="credits">
        Quiz App by <a href="https://twitter.com/PhilippeOzil">@PhilippeOzil</a>
        &nbsp;-&nbsp;Player app v{PLAYER_APP_VERSION}&nbsp;-&nbsp;
        <a href="https://github.com/developerforce/quiz-host-app"
            >Help, issues and feedback</a
        >
    </div>
</template>
